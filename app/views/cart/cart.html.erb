<!-- app/views/cart/cart.html.erb -->
<!DOCTYPE html>
<html>
<head>
  <title>Your Shopping Cart</title>
  <!-- Add your other head elements and styles here -->
  <style>
    /* Your existing styles */
    .birdhouse-image {
  max-width: 100%;
  height: 200px; /* Set a fixed height for all images */
  object-fit: cover; /* Maintain aspect ratio and cover the container */
  border-bottom: 1px solid #eee;
  margin-bottom: 20px;
    }
  </style>
</head>
<body>
<div class="cart-container">
  <h1 class="cart-header">Your Shopping Cart</h1>
  <% if @cart.cart_items.any? %>
    <div class="cart-items">
      <% @cart.cart_items.each do |cart_item| %>
        <div class="cart-item" id="cart-item-<%= cart_item.id %>">
          <%= image_tag "birdhouse#{cart_item.birdhouse.id}.jpg", class: 'birdhouse-image' %>
          <div class="item-details">
            <h2><%= cart_item.birdhouse.Style %></h2>
            <p>
              Quantity: 
              <select name="cart_item[quantity]" id="cart_item_quantity_<%= cart_item.id %>" data-item-id="<%= cart_item.id %>" data-unit-price="<%= cart_item.birdhouse.Price %>" class="quantity-dropdown">
                <% 1.upto(10) do |i| %>
                  <option value="<%= i %>" <%= 'selected' if cart_item.quantity == i %>><%= i %></option>
                <% end %>
              </select>
            </p>
            <p>Unit Price: <%= number_to_currency(cart_item.birdhouse.Price) %></p>
            <p>Total Price: <span id="item-total-<%= cart_item.id %>"><%= number_to_currency(cart_item.quantity * cart_item.birdhouse.Price) %></span></p>
            
            <%= link_to 'Remove', remove_item_path(), method: :delete, data: { confirm: 'Are you sure?' }, class: 'remove-link' %>

          </div>
        </div>
      <% end %>
    </div>

  <div class="total-price">
  <!-- ... other price details ... -->
  <!--<p>Shipping Fee: 5.99 <span id="shipping-fee"><%= @shipping_fee %></span></p>-->
  <!--<p>Taxes: 3.99 <span id="taxes"><%= @taxes %></span></p>-->
  <p>Shipping Fee: 5.99 </p>
  <p>Taxes: 3.99 </p>
  <strong>Total Price (Including Shipping and Taxes):</strong>
  <span id="cart-total"><%= number_to_currency(@total_price) %></span>
  <%= link_to 'Proceed to Checkout', '#', class: 'btn btn-primary' %>
</div> 
  <% else %>
    <p>Your cart is currently empty.</p>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.quantity-dropdown').forEach(function(select) {
      select.addEventListener('change', function() {
        var itemTotalSpan = document.getElementById('item-total-' + this.dataset.itemId);
        var cartTotalSpan = document.getElementById('cart-total');
        var unitPrice = parseFloat(this.dataset.unitPrice);
        var quantity = parseInt(this.value);
        var itemTotal = unitPrice * quantity;
        
        // Update the individual item total
        itemTotalSpan.textContent = itemTotal.toFixed(2);

        // Calculate and update the new cart total
        var cartTotal = 0;
        document.querySelectorAll('.quantity-dropdown').forEach(function(sel) {
          var itemPrice = parseFloat(sel.dataset.unitPrice);
          var itemQty = parseInt(sel.value);
          cartTotal += itemPrice * itemQty;
        });

        cartTotal += 5.99 + 3.99;
        cartTotalSpan.textContent = cartTotal.toFixed(2);

        // You will need to add AJAX call here to update the quantity in the cart on the server side
      });
    });
  });
</script>

</body>
</html>
